// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  PARENT
}

enum RegistrationPeriodStatus {
  OPEN
  CLOSED
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  CHANGES_REQUESTED
  APPROVED
  REJECTED
}

enum StudentGender {
  MALE
  FEMALE
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  passwordHash String        @map("password_hash")
  role         UserRole
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")

  applications Application[]

  @@map("users")
}

model RegistrationPeriod {
  id        String                   @id @default(uuid()) @db.Uuid
  name      String
  startAt   DateTime                 @map("start_at")
  endAt     DateTime                 @map("end_at")
  status    RegistrationPeriodStatus @default(CLOSED)
  createdAt DateTime                 @default(now()) @map("created_at")
  updatedAt DateTime                 @updatedAt @map("updated_at")

  applications Application[]

  @@map("registration_periods")
}

model Application {
  id                     String               @id @default(uuid()) @db.Uuid
  applicationNo          String               @unique @map("application_no")
  applicantEmail         String               @map("applicant_email")
  parentUserId           Int?                 @map("parent_user_id")
  registrationPeriodId   String               @map("registration_period_id") @db.Uuid
  status                 ApplicationStatus    @default(DRAFT)
  decisionReason         String?              @map("decision_reason")
  submittedAt            DateTime?            @map("submitted_at")
  createdAt              DateTime             @default(now()) @map("created_at")
  updatedAt              DateTime             @updatedAt @map("updated_at")

  registrationPeriod     RegistrationPeriod    @relation(fields: [registrationPeriodId], references: [id])
  parentUser             User?                @relation(fields: [parentUserId], references: [id])
  preRegistration        ApplicationPreRegistration?

  @@map("applications")
}

model ApplicationPreRegistration {
  applicationId          String       @id @map("application_id") @db.Uuid
  applicantName           String       @map("applicant_name")
  applicantRelationship   String       @map("applicant_relationship")
  reasonLivingAbroad      String       @map("reason_living_abroad")
  reasonToApply           String       @map("reason_to_apply")
  assignmentCity         String       @map("assignment_city")
  assignmentCountry      String       @map("assignment_country")
  domicileStartDate       DateTime     @map("domicile_start_date") @db.Date
  domicileEndDate        DateTime     @map("domicile_end_date") @db.Date
  permitExpiryDate       DateTime     @map("permit_expiry_date") @db.Date
  programChoice          String       @map("program_choice")
  educationLevel         String       @map("education_level")
  gradeApplied           String       @map("grade_applied")
  studentName            String       @map("student_name")
  studentGender          StudentGender @map("student_gender")
  studentBirthDate       DateTime     @map("student_birth_date") @db.Date
  lastEducationLocation  String       @map("last_education_location")
  nisn                   String?      @map("nisn")

  application            Application  @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("application_pre_registrations")
}

model Bootstrap {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
}

// Schema will be extended in future tasks
// For now, only minimal structure needed for bootstrap
